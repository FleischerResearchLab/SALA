---

title: Analysis By Person


keywords: fastai
sidebar: home_sidebar

summary: "Module processes actiwatch data for a single individual, with the ability to add additional astral (sunset/sunrise) and sleep timing data."
description: "Module processes actiwatch data for a single individual, with the ability to add additional astral (sunset/sunrise) and sleep timing data."
nb_path: "00_analyze_by_person.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_analyze_by_person.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading-Actiwatch-Data">Loading Actiwatch Data<a class="anchor-link" href="#Loading-Actiwatch-Data"> </a></h2><p>To begin processing raw data for analysis, all folders containing Actiwatch data should be loaded into a dictionary. Dictionary keys should be identifying names for the folder where the data is stored, which should be used as the value.</p>
<p>For example:</p>
<p>The below directory uses</p>
<ol>
<li><p><strong>key</strong> = v1</p>

<pre><code> v1 indicates visit number 1, or baseline</code></pre>
</li>
<li><p><strong>value</strong> = data</p>

<pre><code> data indicates that the csv files to be loaded are stored in a folder called "data"</code></pre>
</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">directory</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;v1&#39;</span><span class="p">:</span> <span class="s1">&#39;data&#39;</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="get_raw_data" class="doc_header"><code>get_raw_data</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/analyze_by_person.py#L6" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>get_raw_data</code>(<strong><code>key</code></strong>:<code>str</code>, <strong><code>directory</code></strong>:<code>dict</code>, <strong><code>grouping</code></strong>:<code>str</code>=<em><code>'Group'</code></em>)</p>
</blockquote>
<p>Loads raw actiwatch data for a particular season.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>key: str</p>

<pre><code>The key to load actiwatch data from (for example, "v1")
</code></pre>
<p>directory: dict</p>

<pre><code>Dictionary of valid folders to load actiwatch data from.
Folders should have .csv files in them.
</code></pre>
<p>grouping: str</p>

<pre><code>Name of the generated column for specifying groupings, where
the values will be the name of the key given. Default = 'Group'</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4><p>An example of output for this function would be:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">get_raw_data</span><span class="p">(</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
<span class="n">raw_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Found 1 csv files in data/. Pass #1, raw data
.
.
Pass #2, data summary
.
.EOF without retrieving summary data: data\v1_sample.csv
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Off-Wrist Status</th>
      <th>Activity</th>
      <th>Marker</th>
      <th>White Light</th>
      <th>Red Light</th>
      <th>Green Light</th>
      <th>Blue Light</th>
      <th>Sleep/Wake</th>
      <th>Interval Status</th>
      <th>UID</th>
      <th>Group</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-07 11:28:00</th>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ACTIVE</td>
      <td>v1data\v1</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>2018-05-07 11:28:30</th>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ACTIVE</td>
      <td>v1data\v1</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>2018-05-07 11:29:00</th>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ACTIVE</td>
      <td>v1data\v1</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>2018-05-07 11:29:30</th>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ACTIVE</td>
      <td>v1data\v1</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>2018-05-07 11:30:00</th>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ACTIVE</td>
      <td>v1data\v1</td>
      <td>v1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Recalculating-Timing-Data-(if-Necessary)">Recalculating Timing Data (if Necessary)<a class="anchor-link" href="#Recalculating-Timing-Data-(if-Necessary)"> </a></h2><p>Sometimes it may be valuable to calculate (or recalculate) the timing data. The ability to do so is provided using the below function, which sets up the timing and raw dataframes.</p>
<p>In this example, we'll go ahead and use the Seattle as our location for determining sunlight (sunset and sunrise timings), and ask the function to recalculate both the raw and timing data. Example thresholds for lux are also specified below. The outfile specified is where the data will be written to.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">recalculate_raw</span> <span class="o">=</span> <span class="kc">False</span> 
<span class="n">recalculate_timing</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;seattle&quot;</span>
<span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">]</span> <span class="p">]</span> 
<span class="n">outfile</span> <span class="o">=</span> <span class="s2">&quot;../SALA/example_output/&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="process_timing_data" class="doc_header"><code>process_timing_data</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/analyze_by_person.py#L29" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>process_timing_data</code>(<strong><code>location</code></strong>:<code>str</code>, <strong><code>outfile</code></strong>:<code>str</code>, <strong><code>thresholds</code></strong>:<code>list</code>, <strong><code>key</code></strong>:<code>str</code>, <strong><code>directory</code></strong>:<code>dict</code>, <strong><code>recalc_raw</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>recalc_timing</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Setup timing and raw dataframes or recalculate their
values if specified and necessary. Both operations take
a long time and lots of memory. Ill-advised to recalculate
timing specifically if the data has already been created.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>location: str</p>

<pre><code>Location for calculating light, for example 'Seattle'
</code></pre>
<p>outfile: str</p>

<pre><code>File for re-written data to be placed in, or for data to be loaded from
</code></pre>
<p>thresholds: list</p>

<pre><code>List of light thresholds for the watch data
</code></pre>
<p>key: str</p>

<pre><code>The key to load actiwatch data from
</code></pre>
<p>directory: dict</p>

<pre><code>Dictionary of valid seasons to retrieve actiwatch data from
</code></pre>
<p>recalc_raw: bool</p>

<pre><code>Forces recalculation process if true, loads processed data from disk otherwise.
Default value is 'False'
</code></pre>
<p>recalc_timing: bool</p>

<pre><code>Forces recalculation of light timing data, loads it from disk otherwise.
Default value is 'False'
</code></pre>
<h4 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h4>
<pre><code>(as a tuple of pd.DataFrames) all the data, the timing data for a particular location</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4><p>An example of output for this function would be:</p>
<p><strong>Note</strong>: timing_data is split into three images for easier viewing</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_data</span><span class="p">,</span> <span class="n">timing_data</span> <span class="o">=</span> <span class="n">process_timing_data</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Calculating light timing data...
Adding holiday markers to timing data...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Off-Wrist Status</th>
      <th>Activity</th>
      <th>Marker</th>
      <th>White Light</th>
      <th>Red Light</th>
      <th>Green Light</th>
      <th>Blue Light</th>
      <th>Sleep/Wake</th>
      <th>Interval Status</th>
      <th>UID</th>
      <th>Group</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-07 11:28:00</th>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ACTIVE</td>
      <td>v1data\Hero</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>2018-05-07 11:28:30</th>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ACTIVE</td>
      <td>v1data\Hero</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>2018-05-07 11:29:00</th>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ACTIVE</td>
      <td>v1data\Hero</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>2018-05-07 11:29:30</th>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ACTIVE</td>
      <td>v1data\Hero</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>2018-05-07 11:30:00</th>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>ACTIVE</td>
      <td>v1data\Hero</td>
      <td>v1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>UID</th>
      <th>Date</th>
      <th>Threshold</th>
      <th>Last Light</th>
      <th>Mins to LL from 4AM</th>
      <th>First Light</th>
      <th>Mins to FL from 4AM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>v1data\Hero</td>
      <td>2018-05-22</td>
      <td>5</td>
      <td>2018-05-22 21:28:30</td>
      <td>1048.0</td>
      <td>2018-05-22 06:10:30</td>
      <td>130.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>v1data\Hero</td>
      <td>2018-05-16</td>
      <td>5</td>
      <td>2018-05-17 02:01:00</td>
      <td>1321.0</td>
      <td>2018-05-16 05:31:30</td>
      <td>91.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>v1data\Hero</td>
      <td>2018-05-14</td>
      <td>5</td>
      <td>2018-05-15 01:09:30</td>
      <td>1269.0</td>
      <td>2018-05-14 05:27:00</td>
      <td>87.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>v1data\Hero</td>
      <td>2018-05-09</td>
      <td>5</td>
      <td>2018-05-09 20:39:00</td>
      <td>999.0</td>
      <td>2018-05-09 05:48:00</td>
      <td>108.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>v1data\Hero</td>
      <td>2018-05-11</td>
      <td>5</td>
      <td>2018-05-11 21:52:30</td>
      <td>1072.0</td>
      <td>2018-05-11 06:15:30</td>
      <td>135.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">7</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time above threshold</th>
      <th>Time above threshold AM</th>
      <th>Minutes above threshold</th>
      <th>Minutes above threshold AM</th>
      <th>Lux minutes</th>
      <th>Lux minutes AM</th>
      <th>Group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0 days 13:02:30</td>
      <td>0 days 04:46:30</td>
      <td>782.5</td>
      <td>286.5</td>
      <td>896929.33</td>
      <td>430349.995</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0 days 12:57:30</td>
      <td>0 days 05:38:00</td>
      <td>777.5</td>
      <td>338.0</td>
      <td>566828.43</td>
      <td>453485.575</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0 days 08:35:30</td>
      <td>0 days 03:49:30</td>
      <td>515.5</td>
      <td>229.5</td>
      <td>174880.51</td>
      <td>87783.270</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0 days 13:07:00</td>
      <td>0 days 05:33:30</td>
      <td>787.0</td>
      <td>333.5</td>
      <td>636274.07</td>
      <td>274360.815</td>
      <td>v1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0 days 10:17:00</td>
      <td>0 days 05:04:30</td>
      <td>617.0</td>
      <td>304.5</td>
      <td>706720.19</td>
      <td>354358.550</td>
      <td>v1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">14</span><span class="p">:]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Watch period</th>
      <th>DayofWeek</th>
      <th>GroupDayofWeek</th>
      <th>GroupDayType</th>
      <th>Weekend/Holiday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0 days 00:00:30</td>
      <td>1</td>
      <td>v1Tues</td>
      <td>v1Weekday</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0 days 00:00:30</td>
      <td>2</td>
      <td>v1Wed</td>
      <td>v1Weekday</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0 days 00:00:30</td>
      <td>0</td>
      <td>v1Mon</td>
      <td>v1Weekday</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0 days 00:00:30</td>
      <td>2</td>
      <td>v1Wed</td>
      <td>v1Weekday</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0 days 00:00:30</td>
      <td>4</td>
      <td>v1Fri</td>
      <td>v1Weekday</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setting-Sunset-and-Sunrise-Timings">Setting Sunset and Sunrise Timings<a class="anchor-link" href="#Setting-Sunset-and-Sunrise-Timings"> </a></h2><p>Sunset and sunrise timings can also be calculated for actiwatch data. To do so, the specific location to be calculated for is required. Of most importance for the calculation is the longitude and latitude.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="set_sun_timings" class="doc_header"><code>set_sun_timings</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/analyze_by_person.py#L136" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>set_sun_timings</code>(<strong><code>timing_data</code></strong>, <strong><code>loc</code></strong>:<code>str</code>, <strong><code>region</code></strong>:<code>str</code>, <strong><code>timezone</code></strong>:<code>str</code>, <strong><code>longitude</code></strong>:<code>float</code>, <strong><code>latitude</code></strong>:<code>float</code>)</p>
</blockquote>
<p>Given a location (city), calculate sunset and sunrise timings for the data</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>timing_data: pd.DataFrame</p>

<pre><code>Timing data
</code></pre>
<p>loc: str (any string)</p>

<pre><code>Name of location to lookup for sunrise/sunset calculations
</code></pre>
<p>region: str (any string)</p>

<pre><code>Name of the region the location belongs to
</code></pre>
<p>timezone: str</p>

<pre><code>the location's timezone (a list of timezones can be obtained from pytz.all_timezones)
</code></pre>
<p>longitude: float</p>

<pre><code>Longitude position of the location for sunrise/sunset calculations
</code></pre>
<p>latitude: float</p>

<pre><code>Latitude position of the location for sunrise/sunset calculations
</code></pre>
<h4 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h4>
<pre><code>Modified timing data with sunrise and sunset calculations</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4><p>An example of the added portion to timing data from this function would be:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">set_sun_timings</span><span class="p">(</span><span class="n">timing_data</span><span class="p">,</span> <span class="s2">&quot;Seattle&quot;</span><span class="p">,</span> <span class="s2">&quot;United States&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Los_Angeles&quot;</span><span class="p">,</span> <span class="mf">47.2451</span><span class="p">,</span> <span class="mf">122.438</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">timing_data</span><span class="p">[[</span><span class="s2">&quot;Sunrise&quot;</span><span class="p">,</span> <span class="s2">&quot;Sunset&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sunrise</th>
      <th>Sunset</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-05-21 20:07:06.463156+00:00</td>
      <td>2018-05-22 11:27:22.047832+00:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-05-15 20:13:49.329097+00:00</td>
      <td>2018-05-16 11:20:10.452788+00:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-05-13 20:16:19.055530+00:00</td>
      <td>2018-05-14 11:17:39.760167+00:00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018-05-08 20:23:04.188246+00:00</td>
      <td>2018-05-09 11:11:11.579525+00:00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-05-10 20:20:17.050530+00:00</td>
      <td>2018-05-11 11:13:48.602636+00:00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Adding-Sleep-Information">Adding Sleep Information<a class="anchor-link" href="#Adding-Sleep-Information"> </a></h2><p>Adding sleep information to the timing data is also possible. The below function adds sleep data, splitting a sleep day at 6pm (under the assumption that people generally do not sleep/end their day at 6pm).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="process_sleep_data" class="doc_header"><code>process_sleep_data</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/analyze_by_person.py#L179" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>process_sleep_data</code>(<strong><code>timing_data</code></strong>, <strong><code>num_sleeps</code></strong>:<code>int</code>=<em><code>2</code></em>)</p>
</blockquote>
<p>Processes sleep data for existing timing data.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>timing_data: pd.DataFrame</p>

<pre><code>Timing data
</code></pre>
<p>num_sleeps: int</p>

<pre><code>Cutoff for number of sleeps to display in first resulting frame.
Default = 2, frame will store days with 3+ sleep instances

</code></pre>
<h4 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h4>
<pre><code>short_frame: pd.DataFrame

    Onset, offset, and duration for sleep periods on days with
    more than num_sleeps number of sleep periods
timing_data: pd.DataFrame

    Modified timing data with included sleep information</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4><p>An example of the short frame and a slice of the added sections to the timing data include:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">short_frame</span> <span class="o">=</span> <span class="n">process_sleep_data</span><span class="p">(</span><span class="n">timing_data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">short_frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Sleep period</th>
      <th>Sleep onset</th>
      <th>Sleep offset</th>
      <th>Sleep duration</th>
    </tr>
    <tr>
      <th>UID</th>
      <th>DT</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">v1data\Hero</th>
      <th>2018-05-16</th>
      <td>1</td>
      <td>2018-05-17 02:13:30</td>
      <td>2018-05-17 06:03:30</td>
      <td>0 days 03:50:00</td>
    </tr>
    <tr>
      <th>2018-05-16</th>
      <td>0</td>
      <td>2018-05-16 23:22:30</td>
      <td>2018-05-17 00:16:30</td>
      <td>0 days 00:54:00</td>
    </tr>
    <tr>
      <th>2018-05-16</th>
      <td>2</td>
      <td>2018-05-17 17:05:30</td>
      <td>2018-05-17 17:37:30</td>
      <td>0 days 00:32:00</td>
    </tr>
    <tr>
      <th>2018-05-25</th>
      <td>1</td>
      <td>2018-05-26 00:56:30</td>
      <td>2018-05-26 06:37:30</td>
      <td>0 days 05:41:00</td>
    </tr>
    <tr>
      <th>2018-05-25</th>
      <td>2</td>
      <td>2018-05-26 15:19:00</td>
      <td>2018-05-26 17:30:30</td>
      <td>0 days 02:11:30</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span> <span class="o">=</span> <span class="n">process_sleep_data</span><span class="p">(</span><span class="n">timing_data</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">timing_data</span><span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;Sleep onset&quot;</span><span class="p">,</span> <span class="s2">&quot;Sleep offset&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Sleep duration&quot;</span><span class="p">,</span> <span class="s2">&quot;Sleep onset MSLM&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Sleep offset MSLM&quot;</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sleep onset</th>
      <th>Sleep offset</th>
      <th>Sleep duration</th>
      <th>Sleep onset MSLM</th>
      <th>Sleep offset MSLM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-05-22 21:33:30</td>
      <td>2018-05-23 05:22:30</td>
      <td>0 days 07:49:00</td>
      <td>1293.5</td>
      <td>322.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-05-17 02:13:30</td>
      <td>2018-05-17 06:03:30</td>
      <td>0 days 03:50:00</td>
      <td>1573.5</td>
      <td>363.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-05-14 21:37:30</td>
      <td>2018-05-15 06:18:00</td>
      <td>0 days 08:40:30</td>
      <td>1297.5</td>
      <td>378.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1970-01-01 00:00:00</td>
      <td>1970-01-01 00:00:00</td>
      <td>0 days 00:00:00</td>
      <td>-25430400.0</td>
      <td>-25431840.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-05-11 21:58:30</td>
      <td>2018-05-12 05:05:00</td>
      <td>0 days 07:06:30</td>
      <td>1318.5</td>
      <td>305.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Exporting-Timing-Data">Exporting Timing Data<a class="anchor-link" href="#Exporting-Timing-Data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="export_timing_data" class="doc_header"><code>export_timing_data</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/analyze_by_person.py#L300" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>export_timing_data</code>(<strong><code>timing_data</code></strong>)</p>
</blockquote>
<p>Exports timing data to parquet.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>timing_data: pd.DataFrame</p>

<pre><code>Timing data</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_timing_data</span><span class="p">(</span><span class="n">timing_data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

