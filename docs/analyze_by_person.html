---

title: Analysis By Person


keywords: fastai
sidebar: home_sidebar

summary: "Module processes actiwatch data for a single individual, with the ability to add additional astral (sunset/sunrise) and sleep timing data."
description: "Module processes actiwatch data for a single individual, with the ability to add additional astral (sunset/sunrise) and sleep timing data."
nb_path: "00_analyze_by_person.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_analyze_by_person.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading-Actiwatch-Data">Loading Actiwatch Data<a class="anchor-link" href="#Loading-Actiwatch-Data"> </a></h2><p>Actiwatch data is best served loaded in a directory style setup with key value pairings. This is intended to provide a generally flexible method for labeling groups within the data for easier by-group searching and analysis.</p>
<p>For example:</p>
<p>The below directory uses</p>
<ol>
<li><strong>key</strong> = indicates the group name (for example, base_ or follow<em>up</em>), that is used to both name the grouping within the Group column, and as the front of the generated UID.</li>
</ol>
<ol>
<li><p><strong>value</strong> = indicates that the csv files to be loaded are stored in a folder called "data/v1 or data/v3". The trailing part of the naming convention (after the / ) is appended to the UID. The remaining part of the UID is built using the file name within the subfolder.</p>
<p>Following this structure an example file titled 'user1234' would net a UID of <em>base_v1\user1234</em> as
 its key is <em>base_</em>, its stored in <em>v1</em>, and the title of the csv is <em>user1234</em>.</p>
<p>Also note that the name for their "group" will match the key value used for the directory.</p>
</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">directory</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;base_&#39;</span><span class="p">:</span> <span class="s1">&#39;data/v1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;follow_up_&#39;</span><span class="p">:</span> <span class="s1">&#39;data/v3&#39;</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="get_raw_data" class="doc_header"><code>get_raw_data</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/analyze_by_person.py#L7" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>get_raw_data</code>(<strong><code>key</code></strong>:<code>str</code>, <strong><code>directory</code></strong>:<code>dict</code>, <strong><code>grouping</code></strong>:<code>str</code>=<em><code>'Group'</code></em>)</p>
</blockquote>
<p>Loads raw actiwatch data for a particular group based on a string key.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>key: str</p>

<pre><code>The key to load actiwatch data from (for example, "v1")
</code></pre>
<p>directory: dict</p>

<pre><code>Dictionary of valid folders to load actiwatch data from.
Folders should have .csv files in them.
</code></pre>
<p>grouping: str</p>

<pre><code>Name of the generated column for specifying groupings, where
the values will be the name of the key given. Default = 'Group'</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4><p>An example of output for this function would be:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">get_raw_data</span><span class="p">(</span><span class="s1">&#39;base_&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
<span class="n">raw_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Found 1 csv files in data/v1/. Pass #1, raw data
.
.
Pass #2, data summary
.
.EOF without retrieving summary data: data/v1\user1234_v1sample.csv
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Off-Wrist Status</th>
      <th>Activity</th>
      <th>Marker</th>
      <th>White Light</th>
      <th>Red Light</th>
      <th>Green Light</th>
      <th>Blue Light</th>
      <th>Sleep/Wake</th>
      <th>Interval Status</th>
      <th>UID</th>
      <th>Group</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-06-25 12:31:00</th>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>37.09</td>
      <td>28.4</td>
      <td>15.5</td>
      <td>14.5</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:31:30</th>
      <td>0</td>
      <td>170.0</td>
      <td>0.0</td>
      <td>156.15</td>
      <td>159.0</td>
      <td>59.9</td>
      <td>65.3</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:32:00</th>
      <td>0</td>
      <td>194.0</td>
      <td>0.0</td>
      <td>149.03</td>
      <td>113.0</td>
      <td>49.8</td>
      <td>50.6</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:32:30</th>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>473.95</td>
      <td>365.0</td>
      <td>161.0</td>
      <td>161.0</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:33:00</th>
      <td>0</td>
      <td>62.0</td>
      <td>0.0</td>
      <td>317.82</td>
      <td>264.0</td>
      <td>112.0</td>
      <td>115.0</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Exporting-Timing-Data">Exporting Timing Data<a class="anchor-link" href="#Exporting-Timing-Data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="export_timing_data" class="doc_header"><code>export_timing_data</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/analyze_by_person.py#L30" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>export_timing_data</code>(<strong><code>timing_data</code></strong>)</p>
</blockquote>
<p>Exports timing data to parquet.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>timing_data: pd.DataFrame</p>

<pre><code>Timing data</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Recalculating-Timing-Data-(if-Necessary)">Recalculating Timing Data (if Necessary)<a class="anchor-link" href="#Recalculating-Timing-Data-(if-Necessary)"> </a></h2><p>Sometimes it may be valuable to calculate (or recalculate) the timing data. The ability to do so is provided using the below function, which sets up the timing and raw dataframes.</p>
<p>In this example, we'll go ahead and use the city of Seattle as our location for determining sunlight (sunset and sunrise timings), and ask the function to recalculate both the raw and timing data. Example thresholds for lux are also specified below. The outfile specified is where the data will be written to.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">recalculate_raw</span> <span class="o">=</span> <span class="kc">False</span> 
<span class="n">recalculate_timing</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">]</span> <span class="p">]</span> 
<span class="n">outfile</span> <span class="o">=</span> <span class="s2">&quot;../SALA/example_output/&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="process_timing_data" class="doc_header"><code>process_timing_data</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/analyze_by_person.py#L45" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>process_timing_data</code>(<strong><code>outfile</code></strong>:<code>str</code>, <strong><code>thresholds</code></strong>:<code>list</code>, <strong><code>directory</code></strong>:<code>dict</code>, <strong><code>recalc_raw</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>recalc_timing</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>export_hook</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Setup timing and raw dataframes or recalculate their
values if specified and necessary. Both operations take
a long time and lots of memory. Ill-advised to recalculate
timing specifically if the data has already been created.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>outfile: str</p>

<pre><code>File for re-written data to be placed in, or for data to be loaded from
</code></pre>
<p>thresholds: list</p>

<pre><code>List of light thresholds for the watch data
</code></pre>
<p>key: str</p>

<pre><code>The key to load actiwatch data from
</code></pre>
<p>directory: dict</p>

<pre><code>Dictionary of valid seasons to retrieve actiwatch data from
</code></pre>
<p>recalc_raw: bool</p>

<pre><code>Forces recalculation process if true, loads processed data from disk otherwise.
Default value is 'False'
</code></pre>
<p>recalc_timing: bool</p>

<pre><code>Forces recalculation of light timing data, loads it from disk otherwise.
Default value is 'False'
</code></pre>
<p>export_hook: function</p>

<pre><code>Placeholder for user to use their own function during data processing.
This function should take in the timing data as a parameter. See
documentation for example.
</code></pre>
<h4 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h4>
<pre><code>(as a tuple of pd.DataFrames) all the data, the timing data for a particular location</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Function-Hook-Example">Function Hook Example<a class="anchor-link" href="#Function-Hook-Example"> </a></h3><p>Before exporting timing data within the processing cycle, users can run their own custom analysis function to subset the data as desired. A very minimal example of such a function is provided below.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="remove_first_day" class="doc_header"><code>remove_first_day</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/analyze_by_person.py#L158" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>remove_first_day</code>(<strong><code>timing_data</code></strong>)</p>
</blockquote>
<p>Example function hook for removing data for the first day
where its obvious that light data is non-existent (NaT)</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>timing_data: pd.DataFrame</p>

<pre><code>Timing data</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">remove_first_day</span><span class="p">(</span><span class="n">timing_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Example function hook for removing data for the first day</span>
<span class="sd">    where its obvious that light data is non-existent (NaT)</span>

<span class="sd">     #### Parameters</span>

<span class="sd">    timing_data: pd.DataFrame</span>

<span class="sd">        Timing data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">timing_data</span><span class="p">[(</span><span class="n">timing_data</span><span class="p">[</span><span class="s2">&quot;Last Light&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnat</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
               <span class="o">&amp;</span> <span class="p">(</span><span class="n">timing_data</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">timing_data</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())]</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4><p>An example of output for this function would be:</p>
<p><strong>Note</strong>: timing_data is split into three images for easier viewing</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_data</span><span class="p">,</span> <span class="n">timing_data</span> <span class="o">=</span> <span class="n">process_timing_data</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">remove_first_day</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Loading raw data from disk...
Calculating light timing data...
Adding holiday markers to timing data...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Off-Wrist Status</th>
      <th>Activity</th>
      <th>Marker</th>
      <th>White Light</th>
      <th>Red Light</th>
      <th>Green Light</th>
      <th>Blue Light</th>
      <th>Sleep/Wake</th>
      <th>Interval Status</th>
      <th>UID</th>
      <th>Group</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-06-25 12:31:00</th>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>37.09</td>
      <td>28.4</td>
      <td>15.5</td>
      <td>14.5</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:31:30</th>
      <td>0</td>
      <td>170.0</td>
      <td>0.0</td>
      <td>156.15</td>
      <td>159.0</td>
      <td>59.9</td>
      <td>65.3</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:32:00</th>
      <td>0</td>
      <td>194.0</td>
      <td>0.0</td>
      <td>149.03</td>
      <td>113.0</td>
      <td>49.8</td>
      <td>50.6</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:32:30</th>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>473.95</td>
      <td>365.0</td>
      <td>161.0</td>
      <td>161.0</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:33:00</th>
      <td>0</td>
      <td>62.0</td>
      <td>0.0</td>
      <td>317.82</td>
      <td>264.0</td>
      <td>112.0</td>
      <td>115.0</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>UID</th>
      <th>Date</th>
      <th>Threshold</th>
      <th>Last Light</th>
      <th>Mins to LL from 4AM</th>
      <th>First Light</th>
      <th>Mins to FL from 4AM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>base_v1\user1234</td>
      <td>2018-07-09</td>
      <td>5</td>
      <td>2018-07-09 23:19:00</td>
      <td>1159.0</td>
      <td>2018-07-09 06:39:00</td>
      <td>159.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>base_v1\user1234</td>
      <td>2018-07-07</td>
      <td>5</td>
      <td>2018-07-08 00:01:30</td>
      <td>1201.0</td>
      <td>2018-07-07 06:54:30</td>
      <td>174.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>base_v1\user1234</td>
      <td>2018-07-10</td>
      <td>5</td>
      <td>2018-07-10 08:08:00</td>
      <td>248.0</td>
      <td>2018-07-10 06:59:00</td>
      <td>179.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>base_v1\user1234</td>
      <td>2018-06-29</td>
      <td>5</td>
      <td>2018-06-29 22:18:30</td>
      <td>1098.0</td>
      <td>2018-06-29 06:47:00</td>
      <td>167.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>base_v1\user1234</td>
      <td>2018-07-06</td>
      <td>5</td>
      <td>2018-07-06 23:24:00</td>
      <td>1164.0</td>
      <td>2018-07-06 06:44:30</td>
      <td>164.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">7</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time above threshold</th>
      <th>Time above threshold AM</th>
      <th>Minutes above threshold</th>
      <th>Minutes above threshold AM</th>
      <th>Lux minutes</th>
      <th>Lux minutes AM</th>
      <th>Group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0 days 13:56:00</td>
      <td>0 days 04:35:30</td>
      <td>836.0</td>
      <td>275.5</td>
      <td>1132776.310</td>
      <td>678370.985</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0 days 11:45:30</td>
      <td>0 days 04:37:30</td>
      <td>705.5</td>
      <td>277.5</td>
      <td>814059.620</td>
      <td>355668.225</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0 days 01:00:30</td>
      <td>0 days 01:00:30</td>
      <td>60.5</td>
      <td>60.5</td>
      <td>47044.555</td>
      <td>47044.555</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0 days 05:00:30</td>
      <td>0 days 03:26:30</td>
      <td>300.5</td>
      <td>206.5</td>
      <td>65985.730</td>
      <td>64188.250</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0 days 09:38:30</td>
      <td>0 days 05:00:00</td>
      <td>578.5</td>
      <td>300.0</td>
      <td>432815.220</td>
      <td>298955.700</td>
      <td>base_</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">14</span><span class="p">:]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Watch period</th>
      <th>DayofWeek</th>
      <th>GroupDayofWeek</th>
      <th>GroupDayType</th>
      <th>Weekend/Holiday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0 days 00:00:30</td>
      <td>0</td>
      <td>base_Mon</td>
      <td>base_Weekday</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0 days 00:00:30</td>
      <td>5</td>
      <td>base_Sat</td>
      <td>base_Weekend/Holiday</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0 days 00:00:30</td>
      <td>1</td>
      <td>base_Tues</td>
      <td>base_Weekday</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0 days 00:00:30</td>
      <td>4</td>
      <td>base_Fri</td>
      <td>base_Weekday</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0 days 00:00:30</td>
      <td>4</td>
      <td>base_Fri</td>
      <td>base_Weekday</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setting-Sunset-and-Sunrise-Timings">Setting Sunset and Sunrise Timings<a class="anchor-link" href="#Setting-Sunset-and-Sunrise-Timings"> </a></h2><p>Sunset and sunrise timings can also be calculated for actiwatch data. To do so, the specific location (longidtude and latitude) is required to be fed into the astral package. A label for the location (e.g. a city name like Seattle) is also helpful for clarity.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="set_sun_timings" class="doc_header"><code>set_sun_timings</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/analyze_by_person.py#L175" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>set_sun_timings</code>(<strong><code>timing_data</code></strong>, <strong><code>loc</code></strong>:<code>str</code>, <strong><code>region</code></strong>:<code>str</code>, <strong><code>timezone</code></strong>:<code>str</code>, <strong><code>latitude</code></strong>:<code>float</code>, <strong><code>longitude</code></strong>:<code>float</code>)</p>
</blockquote>
<p>Given a location (city), calculate sunset and sunrise timings for the data</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>timing_data: pd.DataFrame</p>

<pre><code>Timing data
</code></pre>
<p>loc: str (any string)</p>

<pre><code>Name of location to lookup for sunrise/sunset calculations
</code></pre>
<p>region: str (any string)</p>

<pre><code>Name of the region the location belongs to
</code></pre>
<p>timezone: str</p>

<pre><code>the location's timezone (a list of timezones can be obtained from pytz.all_timezones)
</code></pre>
<p>latitude: float</p>

<pre><code>Latitude position of the location for sunrise/sunset calculations
</code></pre>
<p>longitude: float</p>

<pre><code>Longitude position of the location for sunrise/sunset calculations
</code></pre>
<h4 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h4>
<pre><code>Modified timing data with sunrise and sunset calculations</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4><p>An example of the added portion to timing data from this function would be:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">set_sun_timings</span><span class="p">(</span><span class="n">timing_data</span><span class="p">,</span> <span class="s2">&quot;Seattle&quot;</span><span class="p">,</span> <span class="s2">&quot;United States&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Los_Angeles&quot;</span><span class="p">,</span> <span class="mf">47.65</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.30</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">timing_data</span><span class="p">[[</span><span class="s2">&quot;Sunrise&quot;</span><span class="p">,</span> <span class="s2">&quot;Sunset&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sunrise</th>
      <th>Sunset</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-07-09 05:21:39.214048-07:00</td>
      <td>2018-07-09 21:06:51.768689-07:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-07-07 05:19:59.495724-07:00</td>
      <td>2018-07-07 21:07:57.880755-07:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-07-10 05:22:31.640667-07:00</td>
      <td>2018-07-10 21:06:14.940775-07:00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-06-29 05:14:36.884762-07:00</td>
      <td>2018-06-29 21:10:39.206298-07:00</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2018-07-06 05:19:12.313737-07:00</td>
      <td>2018-07-06 21:08:27.123116-07:00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Adding-Sleep-Information">Adding Sleep Information<a class="anchor-link" href="#Adding-Sleep-Information"> </a></h2><p>Adding sleep information to the timing data is also possible. The below function adds sleep data, allowing a "sleep day" to be split at a customizable time. The outputs of the function are</p>

<pre><code>1. short_frame: 
    a separate dataframe meant to be a quick way of visually subsetting and               viewing bi/polyphasic instances. This frame defaults to storing occurances 
    of at least 3 sleep periods within a "sleep day", but can be modified.

2. timing_data:
    modifies input timing data to have all sleep period information</code></pre>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="process_sleep_data" class="doc_header"><code>process_sleep_data</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/analyze_by_person.py#L224" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>process_sleep_data</code>(<strong><code>timing_data</code></strong>, <strong><code>sleep_split</code></strong>:<code>str</code>=<em><code>'18:00'</code></em>, <strong><code>num_sleeps</code></strong>:<code>int</code>=<em><code>3</code></em>)</p>
</blockquote>
<p>Processes sleep data for existing timing data.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>timing_data: pd.DataFrame</p>

<pre><code>Timing data
</code></pre>
<p>sleep_split: str</p>

<pre><code>Time to split the sleep day. Default is "18:00", which is 6:00PM.
</code></pre>
<p>num_sleeps: int</p>

<pre><code>Cutoff for number of sleeps to display in first resulting frame.
Default = 3, frame will store days with 3+ sleep instances

</code></pre>
<h4 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h4>
<pre><code>short_frame: pd.DataFrame

    Onset, offset, and duration for sleep periods on days with
    more than num_sleeps number of sleep periods
timing_data: pd.DataFrame

    Modified timing data with included sleep information</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4><p>An example of the short frame and a slice of the added sections to the timing data include:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">short_frame</span> <span class="o">=</span> <span class="n">process_sleep_data</span><span class="p">(</span><span class="n">timing_data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">short_frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Sleep period</th>
      <th>Sleep onset</th>
      <th>Sleep offset</th>
      <th>Sleep duration</th>
    </tr>
    <tr>
      <th>UID</th>
      <th>DT</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">base_v1\user1234</th>
      <th>2018-06-28</th>
      <td>0</td>
      <td>2018-06-29 00:40:30</td>
      <td>2018-06-29 06:41:00</td>
      <td>0 days 06:00:30</td>
    </tr>
    <tr>
      <th>2018-06-28</th>
      <td>2</td>
      <td>2018-06-29 13:42:00</td>
      <td>2018-06-29 15:23:30</td>
      <td>0 days 01:41:30</td>
    </tr>
    <tr>
      <th>2018-06-28</th>
      <td>1</td>
      <td>2018-06-29 08:50:30</td>
      <td>2018-06-29 09:04:00</td>
      <td>0 days 00:13:30</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">follow_up_v3\user1234</th>
      <th>2018-09-28</th>
      <td>1</td>
      <td>2018-09-28 22:19:30</td>
      <td>2018-09-29 06:51:00</td>
      <td>0 days 08:31:30</td>
    </tr>
    <tr>
      <th>2018-09-28</th>
      <td>0</td>
      <td>2018-09-28 20:07:00</td>
      <td>2018-09-28 21:17:30</td>
      <td>0 days 01:10:30</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span> <span class="o">=</span> <span class="n">process_sleep_data</span><span class="p">(</span><span class="n">timing_data</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">timing_data</span><span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;Sleep onset&quot;</span><span class="p">,</span> <span class="s2">&quot;Sleep offset&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Sleep duration&quot;</span><span class="p">,</span> <span class="s2">&quot;Sleep onset MSLM&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Sleep offset MSLM&quot;</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sleep onset</th>
      <th>Sleep offset</th>
      <th>Sleep duration</th>
      <th>Sleep onset MSLM</th>
      <th>Sleep offset MSLM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-07-09 23:38:30</td>
      <td>2018-07-10 06:57:00</td>
      <td>0 days 07:18:30</td>
      <td>1418.5</td>
      <td>417.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-07-08 00:03:30</td>
      <td>2018-07-08 06:35:30</td>
      <td>0 days 06:32:00</td>
      <td>1443.5</td>
      <td>395.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-07-10 00:00:00</td>
      <td>2018-07-10 00:00:00</td>
      <td>0 days 00:00:00</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-06-29 22:20:00</td>
      <td>2018-06-30 07:44:00</td>
      <td>0 days 09:24:00</td>
      <td>1340.0</td>
      <td>464.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2018-07-07 00:08:00</td>
      <td>2018-07-07 06:53:30</td>
      <td>0 days 06:45:30</td>
      <td>1448.0</td>
      <td>413.5</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Don't forget to export the data once finished.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_timing_data</span><span class="p">(</span><span class="n">timing_data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

