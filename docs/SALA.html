---

title: SALA


keywords: fastai
sidebar: home_sidebar

summary: "Core module of SALA, built to process actiwatch data for a single individual. Prepares actiwatch style data exported in a CSV from Philips Actiware watches and produces additional analyses."
description: "Core module of SALA, built to process actiwatch data for a single individual. Prepares actiwatch style data exported in a CSV from Philips Actiware watches and produces additional analyses."
nb_path: "00_SALA.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_SALA.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SALA" class="doc_header"><code>class</code> <code>SALA</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/SALA.py#L6" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SALA</code>(<strong><code>data</code></strong>=<em><code>None</code></em>, <strong><code>directory</code></strong>=<em><code>None</code></em>, <strong><code>timezone</code></strong>=<em><code>None</code></em>, <strong><code>latitude</code></strong>=<em><code>None</code></em>, <strong><code>longitude</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>DataFrame-like storage for actiwatch data loaded either from a directory of csv files
or an existing SALA or dataframe object.</p>

<pre><code>Attributes
----------
data: pd.DataFrame
    Dataframe of processed timing data

timezone: str
    Single timezone specified for all data within the object. A list of
    valid timezones can be obtained from pytz.all_timezones

latitude: float
    Latitude position for sunrise/sunset calculations

longitude: float
    Longitude position for sunrise/sunset calculations

Methods
-------
init(data=None, directory=None, timezone=None, latitude=None, longitude=None)
    Initialization with a pre-parsed dataframe or raw data and other details

get_raw_data(key, directory, grouping='Group')
    Loads raw actiwatch data

export_timing_data(timing_data)
    Exports timing data to a parquet file

process_timing_data(outfile, thresholds, directory, recalc_raw, recalc_timing, export_hook)
    Handle unprocessed data into two formats: a dataframe with all raw data, another with
    only processed timing data

set_sun_timings(timing_data)
    Calculates sunset and sunrise timing for a single dataframe

process_sleep_data
    Processes sleep data for existing timing data</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Creating-SALA-Objects">Creating SALA Objects<a class="anchor-link" href="#Creating-SALA-Objects"> </a></h2><p>To access the full range of SALA based commands, a SALA object should be created. This can be done by initializing an instance of a SALA object using the initialization method provided. By default, a SALA object can be created without providing any of the necessary data for processing. Below are the intended uses for each of the parameters and how their presence controls SALA functionality. Access to (and manipulation of) these properities is available after initialization as well.</p>
<h4 id="Data">Data<a class="anchor-link" href="#Data"> </a></h4><p>This consists of stored processed timing data within SALA. It is meant to be initialized in cases where pre-parsed data with SALA-like manipulations already exist. Unprocessed data should instead be generated using functions within SALA.</p>
<h4 id="Directory">Directory<a class="anchor-link" href="#Directory"> </a></h4><p>If no processed data exists, a dictionary of strings denoting the locations of files to be processed must be provided in order for data to be processed.</p>
<h4 id="Timezone,-Latitude,-Longitude">Timezone, Latitude, Longitude<a class="anchor-link" href="#Timezone,-Latitude,-Longitude"> </a></h4><p>These location specific information pieces are necessary in generating accurate sunrise
and sunset timings.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="SALA.__init__" class="doc_header"><code>SALA.__init__</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/SALA.py#L49" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>SALA.__init__</code>(<strong><code>data</code></strong>=<em><code>None</code></em>, <strong><code>directory</code></strong>=<em><code>None</code></em>, <strong><code>timezone</code></strong>=<em><code>None</code></em>, <strong><code>latitude</code></strong>=<em><code>None</code></em>, <strong><code>longitude</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Initializes a SALA object either from existing parsed timing data, or from a directory
of csvs. Timezone information can be optionally included to allow for sunset, sunrise
data to be added.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4>
<pre><code>data: pd.DataFrame (optional)
    Pre-parsed dataframe.

directory: dictionary (optional)
    Dictionary of valid folder names to load actiwatch data from.
    Folders should have .csv files in them.

timezone: str (optional)
    A valid timezone (a list of timezones can be obtained from pytz.all_timezones).

latitude: float (optional)
    Latitude position for sunrise/sunset calculations. Northern latitudes
    should be positive values.

longitude: float (optional)
    Longitude position for sunrise/sunset calculations. Eastern longitudes
    should be positive values.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A SALA object can be initialized as follows:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">directory</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;base_&#39;</span><span class="p">:</span> <span class="s1">&#39;data/v1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;follow_up_&#39;</span><span class="p">:</span> <span class="s1">&#39;data/v3&#39;</span>
<span class="p">}</span>
<span class="n">sala</span> <span class="o">=</span> <span class="n">SALA</span><span class="p">(</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading-Actiwatch-Data">Loading Actiwatch Data<a class="anchor-link" href="#Loading-Actiwatch-Data"> </a></h2><p>Actiwatch data should be loaded in a directory style setup with key value pairings. This is intended to provide a generally flexible method for labeling groups within the data for easier by-group searching and analysis.</p>
<p>For example:</p>
<p>The above directory uses</p>
<ul>
<li><strong>key</strong> = indicates the group name (for example, base_ or follow<em>up</em>), that is used to both name the grouping within the Group column, and as the front of the generated UID.</li>
</ul>
<ul>
<li><p><strong>value</strong> = indicates that the csv files to be loaded are stored in a folder called "data/v1 or data/v3". The trailing part of the naming convention (after the / ) is appended to the UID. The remaining part of the UID is built using the file name within the subfolder.</p>
<p>Following this structure an example file titled 'user1234' would net a UID of <em>base_v1\user1234</em> as
 its key is <em>base_</em>, its stored in <em>v1</em>, and the title of the csv is <em>user1234</em>.</p>
<p>Also note that the name for their "group" will match the key value used for the directory.</p>
</li>
</ul>
<p>Combined and loaded data can be retrieved using:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="SALA.get_raw_data" class="doc_header"><code>SALA.get_raw_data</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/SALA.py#L141" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>SALA.get_raw_data</code>(<strong><code>key</code></strong>, <strong><code>directory</code></strong>=<em><code>None</code></em>, <strong><code>grouping</code></strong>=<em><code>'Group'</code></em>)</p>
</blockquote>
<p>Loads raw actiwatch data for a particular group based on a string key.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>key: str</p>

<pre><code>The key to load actiwatch data from (for example, "v1")

</code></pre>
<p>directory: dict</p>

<pre><code>Dictionary of valid folders to load actiwatch data from.
Folders should have .csv files in them. If no dictionary
is provided, it uses the one initialized as part of the SALA
object.

</code></pre>
<p>grouping: str</p>

<pre><code>Name of the generated column for specifying groupings, where
the values will be the name of the key given. Default = 'Group'.

</code></pre>
<h4 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h4><p>All of the raw unprocessed data within the directory.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">sala</span><span class="o">.</span><span class="n">get_raw_data</span><span class="p">(</span><span class="s1">&#39;base_&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
<span class="n">raw_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Found 1 csv files in data/v1/. Pass #1, raw data
.
.
Pass #2, data summary
.
.EOF without retrieving summary data: data/v1\user1234_v1sample.csv
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Off-Wrist Status</th>
      <th>Activity</th>
      <th>Marker</th>
      <th>White Light</th>
      <th>Red Light</th>
      <th>Green Light</th>
      <th>Blue Light</th>
      <th>Sleep/Wake</th>
      <th>Interval Status</th>
      <th>UID</th>
      <th>Group</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-06-25 12:31:00</th>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>37.09</td>
      <td>28.4</td>
      <td>15.5</td>
      <td>14.5</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:31:30</th>
      <td>0</td>
      <td>170.0</td>
      <td>0.0</td>
      <td>156.15</td>
      <td>159.0</td>
      <td>59.9</td>
      <td>65.3</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:32:00</th>
      <td>0</td>
      <td>194.0</td>
      <td>0.0</td>
      <td>149.03</td>
      <td>113.0</td>
      <td>49.8</td>
      <td>50.6</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:32:30</th>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>473.95</td>
      <td>365.0</td>
      <td>161.0</td>
      <td>161.0</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:33:00</th>
      <td>0</td>
      <td>62.0</td>
      <td>0.0</td>
      <td>317.82</td>
      <td>264.0</td>
      <td>112.0</td>
      <td>115.0</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Exporting-Data">Exporting Data<a class="anchor-link" href="#Exporting-Data"> </a></h2><p>SALA provides its own export function for taking existing SALA data and saving it to a parquet file. This is automatically done when running SALA's main processing command as well. An existing directory to save the file to should be provided by the user.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="SALA.export" class="doc_header"><code>SALA.export</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/SALA.py#L175" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>SALA.export</code>(<strong><code>timing_data</code></strong>, <strong><code>outfile</code></strong>)</p>
</blockquote>
<p>Exports existing timing data to a parquet format.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4>
<pre><code>timing_data: pd.DataFrame

Timing data

outfile: str

    Directory to save to. (e.g. ../SALA/example_output/)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Processing-Data">Processing Data<a class="anchor-link" href="#Processing-Data"> </a></h2><p>The main functionality of SALA's core module is collecting and processing both raw and timing data. In most cases, SALA objects will be created without existing dataframes. This function serves to generate processed data with necessary features for plot generation in other SALA modules.</p>
<p>For more details, see the provided example below.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="SALA.process_data" class="doc_header"><code>SALA.process_data</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/SALA.py#L197" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>SALA.process_data</code>(<strong><code>outfile</code></strong>, <strong><code>thresholds</code></strong>, <strong><code>calc_raw</code></strong>=<em><code>False</code></em>, <strong><code>calc_timing</code></strong>=<em><code>False</code></em>, <strong><code>export_hook</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Process existing timing and raw data dataframes by loading them
from disk or calculating their values if specified.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>outfile: str</p>

<pre><code>File for re-written data to be placed in, or for data to be loaded from.

</code></pre>
<p>thresholds: list</p>

<pre><code>List of light thresholds for the watch data.

</code></pre>
<p>key: str</p>

<pre><code>The key to load actiwatch data from.

</code></pre>
<p>calc_raw: bool</p>

<pre><code>Forces calculation process if true, loads processed data from disk otherwise.
Default value is 'False'

</code></pre>
<p>calc_timing: bool</p>

<pre><code>Forces calculation of light timing data and exports the resulting data,
loads it from disk otherwise.
Default value is 'False'

</code></pre>
<p>export_hook: function</p>

<pre><code>Placeholder for user to use their own function during data processing.
This function should take in the timing data as a parameter. See
documentation for example.
</code></pre>
<h4 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h4>
<pre><code>(as a tuple of pd.DataFrames) all the data, the processed timing data</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Adding-Extra-Functions-to-Processing">Adding Extra Functions to Processing<a class="anchor-link" href="#Adding-Extra-Functions-to-Processing"> </a></h3><p>The main processing function provides the ability for users to run their own custom function before exporting. A very minimal example of such a function is provided below.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="remove_first_day" class="doc_header"><code>remove_first_day</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/SALA.py#L453" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>remove_first_day</code>(<strong><code>timing_data</code></strong>)</p>
</blockquote>
<p>Example function hook for removing data for the first day
where its obvious that light data is non-existent (NaT)</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>timing_data: pd.DataFrame</p>

<pre><code>Timing data</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">remove_first_day</span><span class="p">(</span><span class="n">timing_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Example function hook for removing data for the first day</span>
<span class="sd">    where its obvious that light data is non-existent (NaT)</span>

<span class="sd">     #### Parameters</span>

<span class="sd">    timing_data: pd.DataFrame</span>

<span class="sd">        Timing data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">timing_data</span><span class="p">[(</span><span class="n">timing_data</span><span class="p">[</span><span class="s2">&quot;Last Light&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnat</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
               <span class="o">&amp;</span> <span class="p">(</span><span class="n">timing_data</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">timing_data</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())]</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4><p>An example of output for this function would be:</p>
<p><strong>Note</strong>: The resulting data is split into three images for easier viewing</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">]</span> <span class="p">]</span> 
<span class="n">outfile</span> <span class="o">=</span> <span class="s2">&quot;../SALA/example_output/&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_data</span><span class="p">,</span> <span class="n">timing_data</span> <span class="o">=</span> <span class="n">sala</span><span class="o">.</span><span class="n">process_data</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">remove_first_day</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Loading raw data from disk...
Processing light timing data...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Off-Wrist Status</th>
      <th>Activity</th>
      <th>Marker</th>
      <th>White Light</th>
      <th>Red Light</th>
      <th>Green Light</th>
      <th>Blue Light</th>
      <th>Sleep/Wake</th>
      <th>Interval Status</th>
      <th>UID</th>
      <th>Group</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-06-25 12:31:00</th>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>37.09</td>
      <td>28.4</td>
      <td>15.5</td>
      <td>14.5</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:31:30</th>
      <td>0</td>
      <td>170.0</td>
      <td>0.0</td>
      <td>156.15</td>
      <td>159.0</td>
      <td>59.9</td>
      <td>65.3</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:32:00</th>
      <td>0</td>
      <td>194.0</td>
      <td>0.0</td>
      <td>149.03</td>
      <td>113.0</td>
      <td>49.8</td>
      <td>50.6</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:32:30</th>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>473.95</td>
      <td>365.0</td>
      <td>161.0</td>
      <td>161.0</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2018-06-25 12:33:00</th>
      <td>0</td>
      <td>62.0</td>
      <td>0.0</td>
      <td>317.82</td>
      <td>264.0</td>
      <td>112.0</td>
      <td>115.0</td>
      <td>1.0</td>
      <td>ACTIVE</td>
      <td>base_v1\user1234</td>
      <td>base_</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>UID</th>
      <th>Date</th>
      <th>Threshold</th>
      <th>Last Light</th>
      <th>Mins to LL from 4AM</th>
      <th>First Light</th>
      <th>Mins to FL from 4AM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>base_v1\user1234</td>
      <td>2018-07-09</td>
      <td>5</td>
      <td>2018-07-09 23:19:00</td>
      <td>1159.0</td>
      <td>2018-07-09 06:39:00</td>
      <td>159.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>base_v1\user1234</td>
      <td>2018-07-16</td>
      <td>5</td>
      <td>2018-07-16 16:24:30</td>
      <td>744.0</td>
      <td>2018-07-16 14:40:00</td>
      <td>640.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>base_v1\user1234</td>
      <td>2018-07-06</td>
      <td>5</td>
      <td>2018-07-06 23:24:00</td>
      <td>1164.0</td>
      <td>2018-07-06 06:44:30</td>
      <td>164.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>base_v1\user1234</td>
      <td>2018-07-03</td>
      <td>5</td>
      <td>2018-07-03 23:31:00</td>
      <td>1171.0</td>
      <td>2018-07-03 07:00:30</td>
      <td>180.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>base_v1\user1234</td>
      <td>2018-07-01</td>
      <td>5</td>
      <td>2018-07-01 23:11:00</td>
      <td>1151.0</td>
      <td>2018-07-01 08:36:00</td>
      <td>276.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">7</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time above threshold</th>
      <th>Time above threshold AM</th>
      <th>Minutes above threshold</th>
      <th>Minutes above threshold AM</th>
      <th>Lux minutes</th>
      <th>Lux minutes AM</th>
      <th>Group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0 days 13:56:00</td>
      <td>0 days 04:35:30</td>
      <td>836.0</td>
      <td>275.5</td>
      <td>1132776.31</td>
      <td>678370.985</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0 days 00:02:30</td>
      <td>0 days 00:00:00</td>
      <td>2.5</td>
      <td>0.0</td>
      <td>214.50</td>
      <td>0.000</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0 days 09:38:30</td>
      <td>0 days 05:00:00</td>
      <td>578.5</td>
      <td>300.0</td>
      <td>432815.22</td>
      <td>298955.700</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0 days 12:47:30</td>
      <td>0 days 03:37:30</td>
      <td>767.5</td>
      <td>217.5</td>
      <td>377968.04</td>
      <td>143815.500</td>
      <td>base_</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0 days 10:19:30</td>
      <td>0 days 03:06:00</td>
      <td>619.5</td>
      <td>186.0</td>
      <td>949194.78</td>
      <td>165889.685</td>
      <td>base_</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">14</span><span class="p">:]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Watch period</th>
      <th>DayofWeek</th>
      <th>GroupDayofWeek</th>
      <th>GroupDayType</th>
      <th>Weekend/Holiday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0 days 00:00:30</td>
      <td>0</td>
      <td>base_Mon</td>
      <td>base_Weekday</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0 days 00:00:30</td>
      <td>0</td>
      <td>base_Mon</td>
      <td>base_Weekday</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0 days 00:00:30</td>
      <td>4</td>
      <td>base_Fri</td>
      <td>base_Weekday</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0 days 00:00:30</td>
      <td>1</td>
      <td>base_Tues</td>
      <td>base_Weekday</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0 days 00:00:30</td>
      <td>6</td>
      <td>base_Sun</td>
      <td>base_Weekend/Holiday</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setting-Sunset-and-Sunrise-Timings">Setting Sunset and Sunrise Timings<a class="anchor-link" href="#Setting-Sunset-and-Sunrise-Timings"> </a></h2><p>SALA provides the ability to add sunrise and sunset timings to the processed data. To do so, the specific locat ion (longitude and latitude) is required. Labels for location and region are also helpful for user clarity.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="SALA.sun_timings" class="doc_header"><code>SALA.sun_timings</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/SALA.py#L295" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>SALA.sun_timings</code>(<strong><code>location</code></strong>, <strong><code>region</code></strong>)</p>
</blockquote>
<p>Given a location (city) and region as additional markers,
calculate sunset and sunrise timings.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>location: str (any string)</p>

<pre><code>Name of the location to lookup.

</code></pre>
<p>region: str (any string)</p>

<pre><code>Region that the location is located in.

</code></pre>
<h4 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h4>
<pre><code>Modified timing data with sunrise and sunset calculations</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this example, we'll add sunrise and sunset calculations under the assumption that the data is from Seattle. The corresponding timezone for Seattle is "America/Los_Angeles". Since timezone, latitude, and longitude were not provided upon initialization, they must be separately provided before sun timings can be calculated.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sala</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="s2">&quot;America/Los_Angeles&quot;</span>
<span class="n">sala</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="mf">47.65</span>
<span class="n">sala</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="o">-</span><span class="mf">122.30</span>
<span class="n">sala</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">sala</span><span class="o">.</span><span class="n">sun_timings</span><span class="p">(</span><span class="s2">&quot;Seattle&quot;</span><span class="p">,</span> <span class="s2">&quot;United States&quot;</span><span class="p">)</span>
<span class="n">sala</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;Sunrise&quot;</span><span class="p">,</span> <span class="s2">&quot;Sunset&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sunrise</th>
      <th>Sunset</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-07-09 05:21:39.214048-07:00</td>
      <td>2018-07-09 21:06:51.768689-07:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-07-16 05:28:18.610888-07:00</td>
      <td>2018-07-16 21:01:42.757393-07:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-07-06 05:19:12.313737-07:00</td>
      <td>2018-07-06 21:08:27.123116-07:00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018-07-03 05:17:02.116743-07:00</td>
      <td>2018-07-03 21:09:39.386344-07:00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-07-01 05:15:45.287540-07:00</td>
      <td>2018-07-01 21:10:14.543651-07:00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Adding-Sleep-Information">Adding Sleep Information<a class="anchor-link" href="#Adding-Sleep-Information"> </a></h2><p>Adding sleep information to the processed data is also possible. The below function adds sleep data, allowing a "sleep day" to be split at a customizable time. The outputs of the function are</p>

<pre><code>1. short_frame: 
    a separate dataframe meant to be a quick way of visually subsetting and viewing bi/polyphasic instances. 
    This frame defaults to storing occurances of at least 3 sleep periods within a "sleep day", but can be modified.

2. timing_data:
    modifies stored data to have sleep period information</code></pre>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="SALA.process_sleep" class="doc_header"><code>SALA.process_sleep</code><a href="https://github.com/tktran11/SALA/tree/master/SALA/SALA.py#L327" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>SALA.process_sleep</code>(<strong><code>sleep_split</code></strong>=<em><code>'18:00'</code></em>, <strong><code>num_sleeps</code></strong>=<em><code>3</code></em>)</p>
</blockquote>
<p>Processes sleep data for existing timing data.</p>
<h4 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h4><p>timing_data: pd.DataFrame</p>

<pre><code>Timing data

</code></pre>
<p>sleep_split: str</p>

<pre><code>Time to split the sleep day. Default is "18:00", which is 6:00PM.

</code></pre>
<p>num_sleeps: int</p>

<pre><code>Cutoff for number of sleeps to display in first resulting frame.
Default = 3, frame will store days with 3+ sleep instances

</code></pre>
<h4 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h4>
<pre><code>short_frame: pd.DataFrame

    Onset, offset, and duration for sleep periods on days with
    more than num_sleeps number of sleep periods

timing_data: pd.DataFrame

    Modified timing data with included sleep information</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4><p>Example outputs after processing sleep data include:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">short_frame</span><span class="p">,</span> <span class="n">timing_data</span> <span class="o">=</span> <span class="n">sala</span><span class="o">.</span><span class="n">process_sleep</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">short_frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Sleep period</th>
      <th>Sleep onset</th>
      <th>Sleep offset</th>
      <th>Sleep duration</th>
    </tr>
    <tr>
      <th>UID</th>
      <th>DT</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">base_v1\user1234</th>
      <th>2018-06-28</th>
      <td>0</td>
      <td>2018-06-29 00:40:30</td>
      <td>2018-06-29 06:41:00</td>
      <td>0 days 06:00:30</td>
    </tr>
    <tr>
      <th>2018-06-28</th>
      <td>2</td>
      <td>2018-06-29 13:42:00</td>
      <td>2018-06-29 15:23:30</td>
      <td>0 days 01:41:30</td>
    </tr>
    <tr>
      <th>2018-06-28</th>
      <td>1</td>
      <td>2018-06-29 08:50:30</td>
      <td>2018-06-29 09:04:00</td>
      <td>0 days 00:13:30</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">follow_up_v3\user1234</th>
      <th>2018-09-24</th>
      <td>0</td>
      <td>2018-09-24 21:31:00</td>
      <td>2018-09-25 04:44:30</td>
      <td>0 days 07:13:30</td>
    </tr>
    <tr>
      <th>2018-09-24</th>
      <td>1</td>
      <td>2018-09-25 09:16:00</td>
      <td>2018-09-25 10:30:00</td>
      <td>0 days 01:14:00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">timing_data</span><span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;Sleep onset&quot;</span><span class="p">,</span> <span class="s2">&quot;Sleep offset&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Sleep duration&quot;</span><span class="p">,</span> <span class="s2">&quot;Sleep onset MSLM&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Sleep offset MSLM&quot;</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sleep onset</th>
      <th>Sleep offset</th>
      <th>Sleep duration</th>
      <th>Sleep onset MSLM</th>
      <th>Sleep offset MSLM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-07-09 23:38:30</td>
      <td>2018-07-10 06:57:00</td>
      <td>0 days 07:18:30</td>
      <td>1418.5</td>
      <td>417.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-07-16 00:00:00</td>
      <td>2018-07-16 00:00:00</td>
      <td>0 days 00:00:00</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-07-07 00:08:00</td>
      <td>2018-07-07 06:53:30</td>
      <td>0 days 06:45:30</td>
      <td>1448.0</td>
      <td>413.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018-07-03 23:57:30</td>
      <td>2018-07-04 06:14:00</td>
      <td>0 days 06:16:30</td>
      <td>1437.5</td>
      <td>374.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-07-01 20:56:30</td>
      <td>2018-07-02 07:48:30</td>
      <td>0 days 10:52:00</td>
      <td>1256.5</td>
      <td>468.5</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sala</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">sala</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="s2">&quot;../SALA/example_output/&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

